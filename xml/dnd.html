<html>
<head>
  <title></title>
</head>
<body>
<div style="background: lightgray; width: 100px; padding: 10px;" id="drop_zone">Drop files here</div>
<script>
	function handleDragOver(evt) {
		evt.stopPropagation();
		evt.preventDefault();
		evt.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.
	}

	function handleSelect(evt) {
		evt.stopPropagation();
		evt.preventDefault();

		var data;
		var xmlDoc;
		// Did the user drop a file, or drag data out of the eID-Viewer?
		// NOTE: the necessary changes to the eID-Viewer to
		// support this (without saving a file and dropping that
		// out of a file manager) have not yet been released,
		// and won't be until after tax-on-web.
		if(evt.dataTransfer.files.length > 0) {
			// a file, so read it
			var reader = new FileReader();
			reader.onload = function(event) {
				data = reader.result;
			}
			reader.readAsText(evt.dataTransfer.files[0], "UTF-8");
		} else {
			// we get the XML data directly, probably since it was
			// dragged out of the eID-Viewer
			data = evt.dataTransfer.getData("text");
		}
		// Now parse the data
		if(window.DOMParser) {
			parser = new DOMParser();
			xmlDoc = parser.parseFromString(data, "text/xml");
		} else {
			// No HTML5 DOMParser is available; try an
			// IE-specific API.
			xmlDoc = new ActiveXObject("Microsoft.XMLDOM");
			xmlDoc.async = false;
			xmlDoc.loadXML(data);
		}
		// We have the eID XML file as a DOM-tree now. Get
		// information from it:
		// - First name
		var firstName = xmlDoc.getElementsByTagName("firstname")[0].childNodes[0].nodeValue;
		// - Last name
		var lastName = xmlDoc.getElementsByTagName("name")[0].childNodes[0].nodeValue;
		// - National number (which is an attribute of the
		// <identity> element).
		var natNumber = xmlDoc.getElementsByTagName("identity")[0].attributes["nationalnumber"].nodeValue;
		// The full XML file format is described in the file
		// eidv4.xsd, also in this directory.
		window.alert("You dropped identity information for " + firstName + " " + lastName + " with national number " + natNumber);
	}

	// Setup the dnd listeners.
	var dropZone = document.getElementById('drop_zone');
	dropZone.addEventListener('dragover', handleDragOver, false);
	//dropZone.addEventListener('drop', handleFileSelect, false);
	//dropZone.addEventListener('drop', handleTextSelect, false);
	dropZone.addEventListener('drop', handleSelect, false);
</script>
</body>
</html>
